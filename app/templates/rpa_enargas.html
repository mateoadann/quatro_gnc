{% extends "base.html" %}

{% block content %}
<section class="hero compact">
  <div>
    <h1>RPA_Enargas</h1>
    <p>Ejecuta consultas automatizadas y gestiona los PDFs obtenidos.</p>
  </div>
</section>

<section class="grid two-col">
  <div class="card">
    <h2>Nueva consulta</h2>
    <form class="form-grid" method="post">
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
      <div class="form-row">
        <label class="form-field">
          Patente
          <input
            type="text"
            name="patente"
            placeholder="AB123CD"
            pattern="^([A-Za-z]{3}[- ]?[0-9]{3}|[A-Za-z]{2}[- ]?[0-9]{3}[- ]?[A-Za-z]{2})$"
            title="Formato permitido: AAA123 o AA123AA (con o sin guiones/espacios)"
            data-uppercase="true"
            data-strip="alnum"
            required
          />
        </label>
        <div class="form-actions">
          <button class="primary-btn" type="submit">Crear proceso</button>
        </div>
      </div>
      <p class="muted">Solo se aceptan patentes AAA123 o AA123AA (se corrigen guiones/espacios).</p>
    </form>
  </div>

  <div class="card">
    <h2>Guia rapida</h2>
    <div class="helper-block">
      <h3>Estados</h3>
      <ul>
        <li><strong>En proceso:</strong> el RPA esta ejecutando.</li>
        <li><strong>Completado:</strong> termino la consulta.</li>
        <li><strong>Error:</strong> fallo tecnico, reintentar.</li>
      </ul>
      <h3>Resultados</h3>
      <ul>
        <li><strong>Renovación de Oblea:</strong> apto para renovar.</li>
        <li><strong>Prueba Hidraulica:</strong> requiere prueba previa.</li>
        <li><strong>Patente NO registrada:</strong> no figura en ENARGAS.</li>
        <li><strong>Sesión Activa:</strong> esperar y reintentar.</li>
      </ul>
    </div>
  </div>
</section>

<section class="grid stack">
  <div
    class="card"
    data-auto-refresh="{{ 'true' if has_pending else 'false' }}"
    data-refresh-interval="5000"
    data-refresh-url="{{ url_for('main.rpa_enargas_table') }}"
  >
    <h2>Consultas recientes</h2>
    <table>
      <thead>
        <tr>
          <th>Patente</th>
          <th>Estado</th>
          <th>Resultado</th>
          <th>Detalle</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody id="rpa-table-body">
        {% include "partials/rpa_enargas_rows.html" %}
      </tbody>
    </table>
  </div>
</section>
{% endblock %}

{% extends "base.html" %}

{% block content %}
<section class="hero compact">
  <div>
    <h1>RPA_Enargas</h1>
    <p>Ejecuta consultas automatizadas y gestiona los PDFs obtenidos.</p>
  </div>
</section>

<section class="grid">
  <div class="card">
    <h2>Nueva consulta</h2>
    <form class="form-grid" method="post">
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
      <label>
        Patente
        <input
          type="text"
          name="patente"
          placeholder="AB123CD"
          pattern="^([A-Za-z]{3}[0-9]{3}|[A-Za-z]{2}[0-9]{3}[A-Za-z]{2})$"
          title="Formato permitido: AAA123 o AA123AA"
          data-uppercase="true"
          required
        />
      </label>
      <button class="primary-btn" type="submit">Crear proceso</button>
      <p class="muted">Solo se aceptan patentes AAA123 o AA123AA.</p>
    </form>
  </div>

  <div class="card">
    <h2>Consultas recientes</h2>
    <table>
      <thead>
        <tr>
          <th>Patente</th>
          <th>Estado</th>
          <th>Resultado</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        {% for proceso in procesos %}
        <tr>
          <td>{{ proceso.patente }}</td>
          <td><span class="badge {{ proceso.estado|replace(' ', '-') }}">{{ proceso.estado }}</span></td>
          <td>{{ proceso.resultado or "-" }}</td>
          <td>
            {% if proceso.pdf_data %}
            <a class="ghost-btn" href="{{ url_for('main.rpa_enargas_preview', proceso_id=proceso.id) }}" target="_blank" rel="noopener">Previsualizar</a>
            <a class="ghost-btn" href="{{ url_for('main.rpa_enargas_pdf', proceso_id=proceso.id) }}">Descargar</a>
            {% else %}
            <button class="ghost-btn" type="button" disabled>Previsualizar</button>
            <button class="ghost-btn" type="button" disabled>Descargar</button>
            {% endif %}
          </td>
        </tr>
        {% else %}
        <tr>
          <td colspan="4" class="muted">Sin consultas aun.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</section>
{% endblock %}
